# AGENTS.md - Debug Mode

This file provides guidance to agents when working with code in this repository.

## Backend Debugging (Non-Obvious Only)

**Redis/Cache Issues:**
- If cache operations seem to do nothing - this is expected (Redis is disabled)
- `backend/utils/cache.js` and `backend/utils/redis.js` are no-op stubs that return null
- Do not debug cache functionality - it's intentionally disabled

**Route Loading:**
- Routes are loaded recursively from `backend/routers/` directory
- Check console output for `[Route] METHOD /path` messages on startup
- Route pattern: `routers/api/GET__login/index.js` → `GET /api/login`
- Dynamic params `[id]` become `:id` in Express routes

**Authentication Debug:**
- JWT tokens are stored in httpOnly cookies AND checked in Authorization header
- Token fallback: cookies first, then `Authorization: Bearer <token>` header
- User status flow: PENDING → APPROVED → VERIFIED (login requires VERIFIED)
- Check `backend/middleware/auth.js` for token verification logic

**Document Verification Debug:**
- PDF verification uses metadata in document properties, NOT visible QR codes
- Check PDF Title, Subject, Keywords fields for verification data
- Use `backend/utils/documentCrypto.js` for hash/verification debugging

**Upload Debug:**
- Image uploads: 5MB limit, stored in `backend/uploads/`
- PDF uploads: 50MB limit, stored in `backend/uploads/documents/`
- Upload directories are auto-created if missing

## Frontend Debugging (Non-Obvious Only)

**API Debugging:**
- All API calls go through `frontend/src/utils/api.js` - check this file first
- Base URL is `http://localhost:3001` (not 3000)
- 401 errors trigger global interceptor warning in console
- Check browser Network tab for actual API requests

**Routing Debug:**
- Routes are auto-generated by `vite-plugin-pages` from `src/pages/`
- Check console for route registration issues
- Import routes with `import routes from '~react-pages'`

**i18n Debug:**
- Default language is Indonesian (`id`), not English
- Language preference stored in `localStorage` as `i18nextLng`
- Check `frontend/src/i18n.js` for i18n configuration

**Context Debug:**
- `useAlert()` for toast notifications (check AlertContext.jsx)
- `useTheme()` for theme management (check ThemeContext.jsx)
- `useLayout()` for page title management (check LayoutContext.jsx)

**Docker Debug:**
- Backend runs on port 3000 internally, mapped to `BACKEND_PORT` env var
- Frontend runs on port 5173 internally, mapped to `FRONTEND_PORT` env var
- Frontend API URL is `http://localhost:3001` (hardcoded in docker-compose.yml)
